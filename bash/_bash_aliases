#!env bash
# vim: set tabstop=2 shiftwidth=2 foldmethod=marker:

# ~/.profile or ~/.bash_profile read only by interactive shells
# ~/.profile is not read if ~/.bash_profile or ~/.bash_login exists.
# look into the dropbox-only phpenv_phpbuild branch for a same .bash_profile

# source and extra file for non aliases/function stuff
if [ -f ~/.bash_extras ]; then
    . ~/.bash_extras
fi

# aliases {{{
alias L='less -R'
alias df='df -h'
alias ll='ls -AlFh'
alias sl=ls
alias fire='firefox -Profilemanager -no-remote &> /dev/null &'
alias pg='ps aux| grep'
alias pw='pwsafe -Eup -l'
alias pwc='pwsafe -px'
alias rstty='stty start undef stop undef'
alias ..="cd .."
alias ..2="cd ../.."
alias ..3="cd ../../.."
alias ..4="cd ../../../.."
alias ..5="cd ../../../../.."
alias cd..="cd ../"
alias cd...="cd ../.."
alias cd....="cd ../../.."
alias cd.....="cd ../../../.."
alias cd......="cd ../../../../.."
alias bc='bc -l'
alias grep='grep -n --exclude-dir=.svn --exclude-dir=.git '
alias pb='vi ~/.config/pianobar/config'
# {tl,ll,rl}php log {{{
alias tlphp='tail -F /tmp/php5_apache_errorlog.log'
alias llphp='less /tmp/php5_apache_errorlog.log'
alias rlphp='sudo rm /tmp/php5_apache_errorlog.log'
#}}}
alias je="vim ~/.local/share/autojump/autojump.txt"

# Acer specific {{{
alias toff='xinput set-prop "SynPS/2 Synaptics TouchPad" 132 0'
alias koff='xinput set-prop "AT Translated Set 2 keyboard" 132 0'
alias kon='xinput set-prop "AT Translated Set 2 keyboard" 132 1'
#}}}

# vim aliases {{{
# alias for v, vim wrapper at https://github.com/rupa/v.git
# aka: v list standalone
alias vls='v -l'
# aka: v list, reuse vim server session
alias vl='vim="eval $(type vim  | tail -n +2); vim" v -l'
# aka: vim standalone
alias vs="exec_git_expand_args $(which 2>/dev/null vim)"
# vim function that shadows aliases and commands
function vim {
  vim_orig=$(which 2>/dev/null vim)
  $vim_orig --serverlist | grep -q TROLOLOL
  # if server is running
  if [ $? -eq 0 ]; then
      $vim_orig --servername TROLOLOL --remote-silent "$@"
  else
      $vim_orig "$@" --servername TROLOLOL
  fi
}
# alias vi to vim (this is to keep using the vim() bash function that uses the vim --remote feature)
alias vi="exec_git_expand_args vim"
#}}}

#git aliases {{{
alias gg='git grep'
alias gb='git branch -avv'
alias gau='git add -u'
alias gdw='exec_git_expand_args git diff --word-diff --'
alias gdcw='exec_git_expand_args git diff --cached --word-diff --'
alias gl='git --no-pager l -n12'
alias k='git --no-pager ll -n12'
alias gk='gitk --all&'
alias gst='git stash'
# from scm_breeze
alias gsubrm="git_submodule_rm"
alias gl1p="git log -1 -p"
function _git_abbrev_hash_complete () {
  local curw
  MAX_REVS=10
  COMPREPLY=()
  if [[ $COMP_CWORD == 2 ]]; then
    return
  fi
  IFS=$'\n'
  curw=${COMP_WORDS[COMP_CWORD]}
  #display a reminder
  if [[ $COMP_TYPE == 9 && $curw == '' ]]; then
    echo
    git --no-pager log --oneline -n${MAX_REVS}
  fi
  COMPREPLY=($(compgen -W '$(git log --pretty=format:%h -n'$MAX_REVS')' -- $curw))
  IFS=$' \t\n'
}
complete -F _git_abbrev_hash_complete gsf
complete -F _git_abbrev_hash_complete gl1p
#}}}


# old stuff, still used {{{
alias STO='sudo mdadm -S /dev/md0'
alias STA='sudo mdadm -As /dev/md0'
alias vci='vi config.inc.php'
#alias c='cat /proc/mdstat'
#alias rs='rsync -av --delete'
#alias k='kompare -no -'
#alias svnd='svn diff --diff-cmd diff | colordiff | less -r'
#}}}
#}}}

# functions {{{
function pianobar {
  # only way I found, short of unsetting PS1.
  # due to variable visibility, methinks
  echo -ne "\033]0;pianobar\a"
  command pianobar
}
function mkcd () { mkdir -p "$@" && eval cd "\"\$$#\""; }

# as in bash-title
function bt {
  export GROTA_TITLE="$*"
}
#}}}
